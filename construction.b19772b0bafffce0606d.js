(()=>{"use strict";var e,t={8472:(e,t,r)=>{var n=r(6540),o=r(5338),i=r(1925),s=r(2804),l=r(2349),a=(r(2222),r(2927)),u=r(6214),h=r(4903),c=r(5215),d=r(6313),p=r(4817),g=r(7337),m=r(6290),f=r(1275),x=r(4848);function v(e){let{perm:t,commGraph:r,onChange:o=()=>{},tool:i,onPermChanged:s=null}=e,l=(0,f.Y)(),[a,u]=(0,n.useState)(),[v,y]=(0,n.useState)(),[j,b]=(0,n.useState)(),N=(0,p.DB)(!0,!1),w=1+r.numGuidelines,k=r.ioHeight-1,I=(0,p.Ej)(l.screenWidth,[N.left,w,N.right]),P=(0,p.Ej)(l.screenHeight,[N.top,k,N.bottom]),O=new m.az(I[0],P[0],I[0]+I[1],P[0]+P[1]),A=new p.xA(new m.az(0,0,w,k),!1,O),S=Math.min(I[1]/w,P[1]/k)/100,E=!1;function K(e,t,n){let[s,a]=l.getEventPoint(e),c=t?r.graph.getNodeAttribute(t,"type"):void 0;if("insert"===i)if(t)y({fromNode:t}),e.stopPropagation(),e.preventDefault();else{let t=(0,h.f2)(A.xFromScreen(s,a,!0),1,r.numGuidelines),n=A.yFromScreen(s,a,!1),i="usrnd_"+r.getNextId();r.graph.addNode(i,{type:g.R7.Internal,x:t,y:n,guideline:t-1}),r.routeAllPermutations(),o(r),e.stopPropagation(),e.preventDefault()}else"delete"===i?c===g.R7.Internal?(r.graph.dropNode(t),r.routeAllPermutations(),o(r),e.stopPropagation(),e.preventDefault()):n&&(r.graph.dropEdge(n),r.routeAllPermutations(),o(r),e.stopPropagation(),e.preventDefault()):"drag"===i&&c===g.R7.Internal&&(u(t),e.stopPropagation(),e.preventDefault())}function H(e){let[t,n]=l.getEventPoint(e),i=(0,h.f2)(A.xFromScreen(t,n,!0),1,r.numGuidelines),s=A.yFromScreen(t,n,!1),u=r.graph.getNodeAttributes(a);u.guideline=i-1,u.x=i,u.y=s,o(r)}function C(e,t){a&&(H(e),u(void 0),e.stopPropagation(),e.preventDefault()),v&&(t&&v.fromNode!==t&&(r.graph.addEdge(v.fromNode,t),r.routeAllPermutations(),o(r)),y(void 0),e.stopPropagation(),e.preventDefault())}let G=[],R=[];!function(e,n){for(let t=0;t<r.numGuidelines;t++){let[r,n]=A.toScreen(t+1,A.extent.top-1),[o,i]=A.toScreen(t+1,A.extent.bottom+1),s=(0,x.jsx)("line",{x1:r,x2:o,y1:n,y2:i,stroke:"black",strokeWidth:4*S,onMouseDown:e=>K(e,void 0,void 0)},`gdln_${t}`);e.push(s)}r.graph.forEachEdge(((t,n,o,s)=>{let l=r.graph.getNodeAttributes(o),a=r.graph.getNodeAttributes(s),[u,h]=A.toScreen(l.x||0,l.y||0),[c,d]=A.toScreen(a.x||0,a.y||0),p=(0,x.jsx)("line",{className:"delete"===i?"cursor-pointer":"",x1:u,y1:h,x2:c,y2:d,stroke:"white",strokeWidth:2*S,onMouseDown:e=>K(e,void 0,t)},t);e.push(p)}));let o=t?r.routingLut.get(t.lut.toString()):null;if(o){var s=(0,c.yw)(o.length);for(let[t,n]of o.entries())for(let o=0;o<n.length-1;o++){let i=r.graph.getNodeAttributes(n[o]),l=r.graph.getNodeAttributes(n[o+1]),[a,u]=A.toScreen(i.x||0,i.y||0),[h,c]=A.toScreen(l.x||0,l.y||0),d=(0,x.jsx)("line",{className:"pointer-events-none",x1:a,y1:u,x2:h,y2:c,stroke:s(t),strokeWidth:5*S},`path-${t}-${o}`);e.push(d)}}if(v&&j){let t=r.graph.getNodeAttributes(v.fromNode),[n,o]=A.toScreen(t.x||0,t.y||0),i=(0,x.jsx)("line",{x1:n,y1:o,x2:j[0],y2:j[1],stroke:"white",strokeOpacity:.5,strokeWidth:4*S},"edgeInteract");e.push(i)}if("insert"===i&&j){let t=(0,x.jsx)("circle",{cx:j[0],cy:j[1],r:10,fill:c.Wm,fillOpacity:.5},"ghostCirc");e.push(t)}r.graph.forEachNode(((t,r)=>{let o="";"drag"===i?o="cursor-grab":"delete"===i?o="cursor-pointer":"insert"===i&&(o="cursor-crosshair"),(0,g.Tk)(S,A,r.type,(0,g.dg)(r.type),r.x||0,r.y||0,e,n,{className:o,onMouseDown:e=>{K(e,t)},onMouseUp:e=>{C(e,t)}})}))}(G,R);let $=(0,x.jsxs)("svg",{className:"absolute",width:l.screenWidth,height:l.screenHeight,children:[(0,x.jsx)("rect",{ref:l.dummyRectRef,opacity:0,x:"0",y:"0",width:"0",height:"0",stroke:"none",fill:"none"}),G]}),_=t&&(0,x.jsx)(d.A,{onHover:()=>{},onLeave:()=>{},zoom:S,enableTransition:l.enableTransition,perm:t,onPermChanged:s,vertical:E,xyToIdx:(e,t)=>A.yFromScreen(e,t),idxToXY:e=>(0,g.w2)(S,A,...A.toScreen(A.extent.right,e),!1)});return(0,x.jsx)("div",{className:"flex items-stretch w-full h-full p-1",style:{flexDirection:"row"},children:(0,x.jsx)("div",{className:"flex grow items-stretch p-1",onMouseDown:K,onMouseMove:function(e){let[t,r]=l.getEventPoint(e);a?H(e):v&&(y({fromNode:v.fromNode}),e.stopPropagation(),e.preventDefault()),b([t,r])},onMouseUp:C,children:(0,x.jsxs)("div",{ref:l.ref,className:"relative flex grow p-0 m-0 overflow-hidden",children:[$,R,_]})})})}var y=r(3518),j=r(2864);let b=r(6061);class N{constructor(e){this.numGuidelines=3,this.ioHeight=e,this.graph=new j.Ay({type:"undirected"});for(let t=0;t<e;t++){let[e,r]=this.getInputPos(t);this.graph.addNode(N.mkInputKey(t),{type:g.R7.Input,x:e,y:r})}for(let t=0;t<e;t++){let[e,r]=this.getOutputPos(t);this.graph.addNode(N.mkOutputKey(t),{type:g.R7.Output,x:e,y:r})}this.nextId=0,this.useIlp=!1,this.routingLut=new Map}static mkInputKey(e){return"innd-"+e}static mkOutputKey(e){return"outnd-"+e}static makeCompleteBipartiteGraph(e){let t=new N(e);for(let r=0;r<e;r++)for(let n=0;n<e;n++)t.graph.addEdge(N.mkInputKey(r),N.mkOutputKey(n));return t.routeAllPermutations(),t}setNumGuidelines(e){this.numGuidelines=e;for(let e=0;e<this.ioHeight;e++)this.graph.setNodeAttribute(N.mkInputKey(e),"x",this.getInputPos(e)[0]);for(let e=0;e<this.ioHeight;e++)this.graph.setNodeAttribute(N.mkOutputKey(e),"x",this.getOutputPos(e)[0]);this.graph.filterNodes(((t,r)=>r.type===g.R7.Internal&&!!r.guideline&&r.guideline>=e)).forEach((e=>this.graph.dropNode(e))),this.routeAllPermutations()}getInputPos(e){return[0,e]}getOutputPos(e){return[this.numGuidelines+1,e]}centerX(){return(this.numGuidelines+1)/2}centerY(){return(this.ioHeight-1)/2}hasNoValence3Nodes(e,t){let r=new Map;function n(e){let t=r.get(e);return t?t++:t=1,r.set(e,t),t}for(let r=0;r<t.length;r++)if(0!=t[r]){let t=e[r],o=n(this.graph.source(t)),i=n(this.graph.target(t));if(o>2||i>2)return null}return r}routePermutationIlp(e){let t={},r={},n={};function o(e,t){return"p"+t.toString()+"-"+e}function i(e,t){return o(e+"-var",t)}for(let u=0;u<this.ioHeight;u++){let h=N.mkInputKey(u),c=N.mkOutputKey(e.lut[u]);function d(e){return e===h||e===c}this.graph.forEachEdge(((e,s)=>{let l=i(e,u),a=o(e+"-b-eqn",u);t[l]={objective:0},t[l][a]=1,n[l]=1,r[a]={max:1}}));let p=(e,n,o)=>{d(o)&&r[e].min--,this.graph.forEachEdge(o,((r,o,s,l)=>{if(n!==r){let n=i(r,u);t[n][e]||(t[n][e]=0),t[n][e]++}}))};function m(e){return o(e+"-v-eqn",u)}this.graph.forEachEdge(((e,n,s,l)=>{let a=i(e,u),h=o(e+"-e-eqn",u);t[a][h]=-2,r[h]={min:0},p(h,e,s),p(h,e,l)})),this.graph.forEachNode(((e,n)=>{let o=m(e);r[o]={max:d(e)?1:2},this.graph.forEachEdge(e,((e,r,n,s)=>{let l=i(e,u);t[l][o]=1}))}));for(let f=0;f<this.ioHeight;f++){let x=o(f.toString()+"-perm-eqn",f);r[x]={min:0},p(x,void 0,h),p(x,void 0,c),r[x]={min:2}}}this.graph.forEachNode(((e,n)=>{let o=e+"-dj-eqn";r[o]={max:n.type===g.R7.Internal?2:1},this.graph.forEachEdge(e,((e,r,n,s)=>{for(let r=0;r<this.ioHeight;r++){let n=i(e,r);t[n][o]=1}}))}));const s={optimize:"objective",opType:"min",constraints:r,variables:t,ints:n};!function(e){const{optimize:t,opType:r,constraints:n,variables:o}=e;Object.entries(o).map((e=>{let[r,n]=e;const o=n[t]??0;return 0!==o?`${o}*${r}`:null})).filter(Boolean).join(" + ");for(const[e,t]of Object.entries(n))Object.entries(o).map((t=>{let[r,n]=t;const o=n[e]??0;return 0!==o?`${o}*${r}`:null})).filter(Boolean).join(" + "),t.hasOwnProperty("equal"),t.hasOwnProperty("max"),t.hasOwnProperty("min");Object.keys(o)}(s);const l=b.Solve(s);if(!l.feasible)return null;let a=[];for(let v=0;v<this.ioHeight;v++){let y=[N.mkInputKey(v)];for(;;){let j=y.at(-1);if(this.graph.getNodeAttribute(j,"type")===g.R7.Output)break;let w=y.at(-2);for(let k of this.graph.edges(j)){if(1===l[i(k,v)]){let I=this.graph.opposite(j,k);if(I!==w){y.push(I);break}}}}a.push(y)}return a}routeAllPermutations(){return this.useIlp?this.routeAllPermutationsIlp():this.routeAllPermutationsBruteForce()}routeAllPermutationsIlp(){let e=new Map,t=(0,h.NR)(this.ioHeight);for(let r of t){let t=this.routePermutationIlp(r);t&&e.set(r.lut.toString(),t);break}return this.routingLut=e,e}routeAllPermutationsBruteForce(){let e=new Map,t=this.graph.edges(),r=new Map;return t.forEach(((e,t)=>{r.set(e,t)})),(0,m.Ku)(t.length,2,(n=>{let o=this.hasNoValence3Nodes(t,n);if(!o)return!1;for(let e=0;e<this.ioHeight;e++)if(1!==o.get(N.mkInputKey(e)))return!1;for(let e=0;e<this.ioHeight;e++)if(1!==o.get(N.mkOutputKey(e)))return!1;let i=[],s=[];for(let e=0;e<this.ioHeight;e++){let t=[N.mkInputKey(e)];for(;;){let e=t.at(-1),o=t.at(-2),i=!1;for(let s of this.graph.edges(e))if(n[r.get(s)]){let r=this.graph.opposite(e,s);if(r!==o){t.push(r),i=!0;break}}if(!i)break}let o=!1;for(let e=0;e<this.ioHeight;e++){let r=N.mkOutputKey(e);if(t.at(-1)===r){i.push(e),o=!0;break}}if(!o)return!1;s.push(t)}return e.set(i.toString(),s),!1})),this.routingLut=e,e}getNextId(){return this.nextId++}}var w=r(8697),k=r(5773),I=r(5729),P=r(2860);function O(e){return{ioHeight:e,perms:(0,h.NR)(e),selPerm:new h.Ay([...Array(e).keys()]),commGraph:N.makeCompleteBipartiteGraph(e)}}function A(e){let{config:t,setConfig:r}=e,n=t.selPerm;function o(e,n){let o=n.map((n=>(0,x.jsx)("div",{className:`text-center w-full cursor-pointer rounded-lg p-1 shadow-md hover:shadow-xl active:bg-gray-900 hover:bg-gray-400/10 transition text-white\n            ${n.lut.toString()===e.lut.toString()?"bg-gray-700":"bg-gray-700/10"}\n            ${t.commGraph.routingLut.get(n.lut.toString())?"":"border border-red-500"}\n          `,onClick:()=>r({...t,selPerm:n}),children:(0,x.jsx)(u.KI,{children:n.toLatex()})},n.lut.toString())));return(0,x.jsx)("div",{className:"grid grid-cols-[repeat(auto-fit,_minmax(50px,_1fr))] gap-4 p-4",children:o})}let i=[],s=[];for(let e of t.perms){t.commGraph.routingLut.get(e.lut.toString())?i.push(e):s.push(e)}return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)("span",{className:"text-sm mb-1 flex row font-bold",children:[(0,x.jsx)(w.A,{className:"text-red-500"})," Unroutable permutations:"]}),n&&s.length>0?o(n,s):"None!",(0,x.jsxs)("span",{className:"text-sm flex row mb-1 font-bold",children:[(0,x.jsx)(k.A,{className:"text-green-500"})," Routable permutations:"]}),(0,x.jsxs)("div",{className:"relative w-full",children:[(0,x.jsx)(I.z,{value:100*i.length/t.perms.length,className:"h-6",showValue:!1}),(0,x.jsx)("span",{className:"absolute inset-0 flex items-center justify-center text-sm font-medium text-white drop-shadow-[0_0_2px_black]",children:(0,x.jsx)(u.KI,{children:`${i.length} / ${t.perms.length}=${t.ioHeight}!`})})]}),n&&i.length>0?o(n,i):"None, get to work!"]})}function S(){let[e,t]=(0,n.useState)((()=>O(3))),r=e.commGraph,[o,l]=(0,n.useState)("insert"),[,h]=(0,n.useReducer)((e=>e+1),0),d=(0,n.useRef)(null);return(0,x.jsxs)(i.O,{className:"h-dvh w-full",ref:d,children:[(0,x.jsx)(i.K,{size:60,className:"overflow-hidden",children:(0,x.jsx)(y.sR,{activeTool:o,onChange:l,children:(0,x.jsx)("div",{className:"flex-1",children:(0,x.jsx)(v,{tool:o,commGraph:r,perm:e.selPerm,onChange:()=>h(),onPermChanged:r=>t({...e,selPerm:r})})})})}),(0,x.jsx)(i.K,{size:40,className:"",children:(0,x.jsxs)("div",{className:"pl-7 pr-7 space-y-4 overflow-auto",children:[(0,x.jsx)("h1",{className:"text-xl font-bold my-4 font-italic",children:"Communication Network Construction"}),(0,x.jsxs)("div",{className:"text-sm",children:[(0,x.jsx)("label",{className:"block mb-1 font-bold",htmlFor:"vertical",children:"Routing:"}),(0,x.jsx)(a.J,{className:"w-full",value:r.useIlp?"ILP":"Brute-Force",onChange:n=>{r.useIlp="ILP"==n.value,t({...e})},options:["ILP","Brute-Force"]})]}),(0,x.jsxs)("p",{children:["A communication network is an graph with special nodes: ",(0,x.jsxs)("span",{style:{color:c.an},children:[(0,x.jsx)(u.KI,{children:"n"}),' "input nodes"']})," and ",(0,x.jsx)("span",{style:{color:c.$I},children:'"output nodes"'})]}),(0,x.jsxs)("p",{children:["We refer to ",(0,x.jsx)(u.KI,{children:"n"})," as the height of the communication network."]}),(0,x.jsxs)("p",{children:["We say it is uncongested if any bijection ",(0,x.jsx)(u.KI,{children:"\\pi \\in S_n"})," from its ",(0,x.jsxs)("span",{style:{color:c.an},children:[(0,x.jsx)(u.KI,{children:"n"})," input nodes"]})," to its ",(0,x.jsxs)("span",{style:{color:c.$I},children:[(0,x.jsx)(u.KI,{children:"n"})," output nodes"]})," can be realized by vertex-disjoint paths. A set of such paths(or routes) is called a routing. You can click and drag the permutation arrows to modify the permutation, or alternatively, dial one of the permutations in the list below. Try it!"]}),(0,x.jsxs)("div",{className:"text-sm",children:[(0,x.jsxs)("label",{className:"block mb-1 font-bold",htmlFor:"inputHeight",children:["Height ",(0,x.jsx)(u.KI,{children:"n"}),":"]}),(0,x.jsx)(s.Y,{className:"",name:"inputHeight",value:e.ioHeight,onValueChange:e=>{let r=e.value;if(r&&!isNaN(r)){let e=O(r);t(e),h()}},mode:"decimal",showButtons:!0,min:1,max:5})]}),(0,x.jsxs)("p",{children:['This playground lets you construct "good" uncongested communication networks (Even though it may be a good warm-up to construct a bad one first.) Your current network has ',(0,x.jsx)(u.KI,{children:`${r.graph.order} \\geq 2n=${2*e.ioHeight}`})," nodes and ",(0,x.jsx)(u.KI,{children:`${r.graph.size}`})," edges."]}),(0,x.jsx)("p",{children:"For convenience, nodes snap to vertical equispaced guidelines. You can set the number of guidelines below."}),(0,x.jsxs)("div",{className:"text-sm",children:[(0,x.jsx)("label",{className:"block mb-1 font-bold",htmlFor:"inputHeight",children:"Number of guidelines:"}),(0,x.jsx)(s.Y,{className:"",name:"inputHeight",value:r.numGuidelines,onValueChange:n=>{let o=n.value;o&&!isNaN(o)&&(r.setNumGuidelines(o),h(),t({...e}))},mode:"decimal",showButtons:!0,min:1,max:8})]}),(0,x.jsx)(A,{config:e,setConfig:t})]})})]})}const E=o.createRoot(document.getElementById("root"));(0,u._)(),E.render((0,x.jsx)(n.StrictMode,{children:(0,x.jsx)(l.mD,{children:(0,x.jsxs)("div",{className:"fixed flex overflow-hidden h-dvh w-full",children:[(0,x.jsx)(S,{}),(0,x.jsx)(P.A,{})]})})}))}},r={};function n(e){var o=r[e];if(void 0!==o)return o.exports;var i=r[e]={exports:{}};return t[e](i,i.exports,n),i.exports}n.m=t,e=[],n.O=(t,r,o,i)=>{if(!r){var s=1/0;for(h=0;h<e.length;h++){for(var[r,o,i]=e[h],l=!0,a=0;a<r.length;a++)(!1&i||s>=i)&&Object.keys(n.O).every((e=>n.O[e](r[a])))?r.splice(a--,1):(l=!1,i<s&&(s=i));if(l){e.splice(h--,1);var u=o();void 0!==u&&(t=u)}}return t}i=i||0;for(var h=e.length;h>0&&e[h-1][2]>i;h--)e[h]=e[h-1];e[h]=[r,o,i]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.j=276,(()=>{var e={276:0,869:0};n.O.j=t=>0===e[t];var t=(t,r)=>{var o,i,[s,l,a]=r,u=0;if(s.some((t=>0!==e[t]))){for(o in l)n.o(l,o)&&(n.m[o]=l[o]);if(a)var h=a(n)}for(t&&t(r);u<s.length;u++)i=s[u],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(h)},r=self.webpackChunkreact_ts_tailwind_starter=self.webpackChunkreact_ts_tailwind_starter||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var o=n.O(void 0,[869,967,810,76],(()=>n(8472)));o=n.O(o)})();
//# sourceMappingURL=construction.b19772b0bafffce0606d.js.map