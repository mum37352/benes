{"version":3,"file":"construction.4a21a8579d3f72285aa7.js","mappings":"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","sources":["webpack://react-ts-tailwind-starter/webpack/runtime/chunk loaded","webpack://react-ts-tailwind-starter/./src/construction/Construction.tsx","webpack://react-ts-tailwind-starter/./src/common/Colors.tsx","webpack://react-ts-tailwind-starter/./src/common/Permutation.tsx","webpack://react-ts-tailwind-starter/./src/construction/page.tsx","webpack://react-ts-tailwind-starter/webpack/bootstrap","webpack://react-ts-tailwind-starter/webpack/runtime/define property getters","webpack://react-ts-tailwind-starter/webpack/runtime/hasOwnProperty shorthand","webpack://react-ts-tailwind-starter/webpack/runtime/runtimeId","webpack://react-ts-tailwind-starter/webpack/runtime/jsonp chunk loading","webpack://react-ts-tailwind-starter/webpack/startup"],"sourcesContent":["var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","import useResizeObserver from \"@react-hook/resize-observer\";\nimport * as d3 from \"d3\";\nimport { useLayoutEffect, useReducer, useRef, useState } from \"react\";\nimport Permutation from \"../common/Permutation\";\nimport { assert } from \"console\";\nimport { backgroundColor, inputColor, midColor, outputColor } from \"../common/Colors\";\n\nlet width = 928;\nlet height = 680;\n\nenum GraphNodeType {\n  Input,\n  Output,\n  Internal\n}\n\ninterface GraphNode extends d3.SimulationNodeDatum {\n  type: GraphNodeType,\n  key: string\n}\n\ntype GraphEdge = d3.SimulationLinkDatum<GraphNode>;\n\nclass Graph {\n  constructor(ioHeight: number) {\n    this.xScale = d3.scaleLinear([-6, +6], [0, width]);\n    this.yScale = d3.scaleLinear([-1, ioHeight], [0, height]);\n\n    this.ioHeight = ioHeight;\n\n    this.inputs = [];\n    for (let inputIdx = 0; inputIdx < ioHeight; inputIdx++) {\n      let node : GraphNode = {key: \"in_\"+inputIdx, type: GraphNodeType.Input, fy: this.yScale(inputIdx), fx: this.xScale(-5)};\n      this.inputs.push(node);\n    }\n    this.outputs = [];\n    for (let outputIdx = 0; outputIdx < ioHeight; outputIdx++) {\n      let node : GraphNode = {key: \"out_\"+outputIdx, type: GraphNodeType.Output, fy: this.yScale(outputIdx), fx: this.xScale(+5)};\n      this.outputs.push(node);\n    }\n\n    this.nextId = 0;\n\n    let nodeA : GraphNode = {key: \"r\", type: GraphNodeType.Internal};\n    let nodeB : GraphNode = {key: \"j\", type: GraphNodeType.Internal};\n    this.nodes = [...this.inputs, ...this.outputs, nodeA, nodeB, {key: \"k\", type: GraphNodeType.Internal}];\n    this.edges = [{source: nodeA, target: nodeB}];\n  }\n\n  routePermutation(perm: Permutation) {\n    let paths: GraphNode[][] = [];\n    let visitedVerts = new Set<GraphNode>();\n    let success = this.routePermutation_recurse(perm, 0, paths, visitedVerts);\n\n    return success ? paths : null;\n  }\n\n  routePermutation_recurse(perm: Permutation, pathIdx: number, paths: GraphNode[][], visitedVerts: Set<GraphNode>) {\n    let dst = this.outputs[perm.lut[pathIdx]];\n\n    let newPath : GraphNode[] = [];\n    type StackEntry = {node: GraphNode, pathIdx: number};\n    let stack : StackEntry[] = [{node: this.inputs[pathIdx], pathIdx: 0}];\n\n    for (;;) {\n      let atEntry = stack.pop();\n\n      if (!atEntry) {\n        break;\n      }\n\n      // Truncate.\n      newPath.length = atEntry.pathIdx;\n      newPath.push(atEntry.node);\n\n      if (visitedVerts.has(atEntry.node)) {\n        continue;\n      }\n\n      visitedVerts.add(atEntry.node);\n\n      if (atEntry.node === dst) {\n        paths.push(newPath);\n\n        if (pathIdx < this.ioHeight - 1) {\n          if (this.routePermutation_recurse(perm, pathIdx + 1, paths, visitedVerts)) {\n            return true;\n          }\n\n          paths.pop();\n        } else {\n          return true;\n        }\n      }\n\n      newPath.push();\n\n      let neighbors = this.adjacentVerts(atEntry.node);\n      for (let neighbor of neighbors) {\n        stack.push({node: neighbor, pathIdx: newPath.length});\n      }\n    }\n\n    // Could not find a path.\n    return false;\n  }\n\n  adjacentVerts(node: GraphNode) {\n    let result = [];\n\n    for (let edge of this.edges) {\n      if (edge.source === node) {\n        result.push(edge.source);\n      } else if (edge.target === node) {\n        result.push(edge.target);\n      }\n    }\n\n    return result;\n  }\n\n  getNextId() {\n    return this.nextId++;\n  }\n\n  nextId: number;\n\n  xScale: d3.ScaleLinear<number, number>;\n  yScale: d3.ScaleLinear<number, number>;\n\n  ioHeight: number;\n  inputs: GraphNode[];\n  outputs: GraphNode[];\n  nodes: GraphNode[];\n  edges: GraphEdge[];\n}\n\ntype AddEdgeInteraction = {\n  fromNode: GraphNode,\n  toX: number,\n  toY: number\n};\n\nexport default function Construction({\n  ioHeight\n} : {ioHeight: number})\n{\n  let ref = useRef<HTMLDivElement>(null);\n  let dummyRectRef = useRef<SVGRectElement>(null);\n  let [size, setSize] = useState<DOMRect|undefined>();\n\n  let [draggedNode, setDraggedNode] = useState<GraphNode>();\n  let [edgeInteraction, setEdgeInteraction] = useState<AddEdgeInteraction>();\n\n  // TODO: This will execute the constructor every time we render.\n  let [graph, setGraph] = useState<Graph>(new Graph(ioHeight));\n\n  let [simulation, setSimulation] = useState<d3.Simulation<GraphNode, undefined>>();\n  let [, forceUpdate] = useReducer(x => x + 1, 0);\n  \n  let screenWidth = size?.width || 0;\n  let screenHeight = size?.height || 0;\n\n\n  let vertical = false;\n\n  function ticked() {\n    forceUpdate();\n  }\n  \n  useLayoutEffect(() => {\n    setSize(ref.current?.getBoundingClientRect());\n\n    let sim = d3.forceSimulation(graph.nodes)\n\n    sim.on(\"tick\", ticked);\n    sim.force(\"charge\", d3.forceManyBody());\n    sim.force(\"springs\", d3.forceLink(graph.edges))\n\n    setSimulation(sim);\n  }, [ref]);\n\n  if (typeof window !== \"undefined\") {\n    useResizeObserver(ref, entry => setSize(entry.contentRect));\n  }\n\n  function getEventPoint(e: React.MouseEvent) {\n    let svgPoint = new DOMPoint(e.clientX, e.clientY);\n    //console.log(\"client\", svgPoint);\n    svgPoint = svgPoint.matrixTransform(dummyRectRef.current?.getScreenCTM()?.inverse());\n    //console.log(\"xform\", svgPoint);\n    //svgPoint.x = graph.xScale.invert(svgPoint.x);\n    //svgPoint.y = graph.yScale.invert(svgPoint.y);\n    //console.log(\"scale\", svgPoint);\n    return [svgPoint.x, svgPoint.y];\n  }\n\n  function reheat() {\n    simulation?.nodes(graph.nodes).alpha(1).restart();\n    forceUpdate();\n  }\n\n  function handleMouseDown(e: React.MouseEvent, node?: GraphNode) {\n    let [ex, ey] = getEventPoint(e);\n\n    if (e.ctrlKey) {\n      let newNode: GraphNode = { type: GraphNodeType.Internal, key: \"usrnd_\" + graph.getNextId(), y: ey, x: ex };\n\n      graph.nodes.push(newNode);\n      reheat();\n      e.stopPropagation();\n    } else if (e.altKey) {\n      if (node) {\n        setEdgeInteraction({\n          fromNode: node,\n          toX: ex,\n          toY: ey\n        });\n        e.stopPropagation();\n      }\n    } else {\n      if (node?.type === GraphNodeType.Internal) {\n        setDraggedNode(node);\n        e.stopPropagation();\n      }\n    }\n  }\n\n  function handleMouseMove(e: React.MouseEvent) {\n    let [ex, ey] = getEventPoint(e);\n\n    if (draggedNode) {\n      draggedNode.fx = ex;\n      draggedNode.fy = ey;\n      reheat();\n    } else if (edgeInteraction) {\n      setEdgeInteraction({\n        fromNode: edgeInteraction.fromNode,\n        toX: ex,\n        toY: ey\n      });\n      e.stopPropagation();\n    }\n  }\n\n  function handleMouseUp(e: React.MouseEvent, node?: GraphNode) {\n    let [ex, ey] = getEventPoint(e);\n\n    if (draggedNode) {\n      draggedNode.fx = draggedNode.fy = undefined;\n      draggedNode.x = ex;\n      draggedNode.y = ey;\n      reheat();\n      setDraggedNode(undefined);\n      e.stopPropagation();\n    }\n\n    if (edgeInteraction) {\n      if (node) {\n        console.log(\"Adding new edge\");\n        let newEdge: GraphEdge = {\n          source: edgeInteraction.fromNode,\n          target: node\n        };\n        graph.edges.push(newEdge);\n        console.log(graph.edges);\n      }\n\n      reheat();\n      setEdgeInteraction(undefined);\n      e.stopPropagation();\n    }\n  }\n\n  function drawGraph(canvas: React.JSX.Element[]) {\n    for (let edge of graph.edges) {\n      let src = edge.source as GraphNode;\n      let tgt = edge.target as GraphNode;\n\n      let line = <line key={edge.index} x1={src.x} y1={src.y} x2={tgt.x} y2={tgt.y} stroke=\"white\" strokeWidth={4} />;\n\n      canvas.push(line);\n    }\n\n    if (edgeInteraction) {\n      let src = edgeInteraction.fromNode;\n      let line = <line key={\"edgeInteract\"} x1={src.x} y1={src.y} x2={edgeInteraction.toX} y2={edgeInteraction.toY} stroke=\"white\" strokeWidth={4} />;\n\n      canvas.push(line);\n    }\n\n    for (let node of graph.nodes) {\n      let color;\n      if (node.type === GraphNodeType.Internal) {\n        color = midColor;\n      } else if (node.type === GraphNodeType.Input) {\n        color = inputColor;\n      } else if (node.type === GraphNodeType.Output) {\n        color = outputColor;\n      }\n\n      let circ = <circle key={node.key} cx={node.x} cy={node.y} r={10} fill={color} onMouseDown={e => handleMouseDown(e, node)} onMouseUp={e => handleMouseUp(e, node)}/>\n\n      canvas.push(circ);\n    }\n  }\n\n  let graphCanvas : React.JSX.Element[] = [];\n  drawGraph(graphCanvas);\n\n  let svg = <svg className=\"absolute\" width={screenWidth} height={screenHeight} viewBox={`0 0 ${width} ${height}`} onMouseDown={handleMouseDown} onMouseMove={handleMouseMove} onMouseUp={handleMouseUp}>\n    <rect ref={dummyRectRef} opacity={0} x=\"0\" y=\"0\" width=\"0\" height=\"0\" stroke=\"none\" fill=\"none\" />\n    {graphCanvas}\n  </svg>;\n\n  return <div className=\"flex items-stretch w-full h-full p-1\" style={{ background: backgroundColor, flexDirection: vertical ? \"column\" : \"row\"}}>\n    <div className=\"flex grow items-stretch p-1\">\n      <div ref={ref} className=\"relative flex grow p-0 m-0 overflow-hidden\" >\n        {svg}\n      </div>\n    </div>\n  </div>\n}","// Based on https://github.com/vv9k/vim-github-dark\nexport let backgroundColor = \"#161b22\";\nexport let inputColor = \"#faa356\";\nexport let outputColor = \"#a2d2fb\";\nexport let midColor = \"#ecf2f8\";\nexport let topColor = \"#7ce38b\";\nexport let bottomColor = \"#cea5fb\";","export default class Permutation {\n  constructor(lut: number[]) {\n    this.lut = [...lut];\n\n    // Compute the inverse.\n    this.invLut = Array<number>(lut.length)\n    for (let i = 0; i < lut.length; i++) {\n      this.invLut[lut[i]] = i;\n    }\n  }\n\n  invert() {\n    let swap = this.invLut;\n    this.invLut = this.lut;\n    this.lut = swap;\n  }\n\n  lut: number[];\n  invLut: number[];\n}\n\nfunction allPerms_recurse(unusedNums: Set<number>, lut: number[], n: number, perms: Permutation[]) {\n  if (lut.length === n) {\n    perms.push(new Permutation(lut));\n    return;\n  }\n\n  let unusedList = Array.from(unusedNums).toSorted();\n\n  for (let unusedNum of unusedList) {\n    lut.push(unusedNum);\n    unusedNums.delete(unusedNum);\n    allPerms_recurse(unusedNums, lut, n, perms);\n    unusedNums.add(unusedNum);\n    lut.pop();\n  }\n}\n\nexport function allPerms(n: number) {\n  let unusedNums = new Set<number>();\n\n  for (let i = 0; i < n; i++) {\n    unusedNums.add(i);\n  }\n\n  let result: Permutation[] = [];\n\n  allPerms_recurse(unusedNums, [], n, result);\n\n  return result;\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom/client';\n\nimport '@/styles/index.css';\nimport { useState } from \"react\";\nimport BenesNet from \"../route-benes/BenesNet\";\nimport NoSsr from \"../common/NoSsr\";\nimport { Splitter, SplitterPanel } from 'primereact/splitter';\nimport { InputNumber, InputNumberValueChangeEvent } from 'primereact/inputnumber';\nimport { PrimeReactProvider } from 'primereact/api';\nimport \"primereact/resources/themes/lara-dark-teal/theme.css\";\nimport { InputSwitch, InputSwitchChangeEvent } from \"primereact/inputswitch\";\nimport { SelectButton } from \"primereact/selectbutton\";\nimport { initMacros, KI } from \"../common/katex\";\nimport Construction from \"./Construction\";\nimport Permutation, { allPerms } from \"../common/Permutation\";\nimport { inputColor, outputColor } from \"../common/Colors\";\n\nfunction Main()\n{\n  let [ioHeight, setIoHeight] = useState<number>(4);\n  let [perms, setPerms] = useState<Permutation[]>(allPerms(3));\n\n  let permCards: React.JSX.Element[] = [];\n\n  for (let perm of perms) {\n    console.log(perm.toString());\n    permCards.push(\n      <div>\n        {perm.lut.toString()}\n        <Construction ioHeight={ioHeight} />\n      </div>\n    );\n  }\n\n  return <Splitter className=\"h-dvh w-full\">\n    <SplitterPanel size={75} className=\"overflow-hidden\">\n      <div className=\"flex flex-col w-full\">\n        <div>\n           <InputNumber className=\"w-full\" name=\"benesOrder\" value={ioHeight} onValueChange={(e: InputNumberValueChangeEvent) => {\n            let val = e.value;\n            if (val && !isNaN(val)) {\n              setIoHeight(val)\n            }\n          }} mode=\"decimal\" showButtons min={1} max={5} />\n        </div>\n        <Construction ioHeight={3} />\n      </div>\n    </SplitterPanel>\n    <SplitterPanel size={25} className=\"\">\n      <div className=\"flex flex-col\">\n        Click and drag to move nodes, Ctrl-Click to add nodes, Alt-Click to add edges.\n\n        <h1>Permutations</h1>\n\n        {permCards}\n      </div>\n    </SplitterPanel>\n  </Splitter>;\n}\n\nconst root = ReactDOM.createRoot(document.getElementById('root')!);\n\ninitMacros();\nroot.render(\n  <React.StrictMode>\n      <PrimeReactProvider>\n        <Main />\n      </PrimeReactProvider>\n  </React.StrictMode>\n);\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","__webpack_require__.j = 276;","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t276: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkreact_ts_tailwind_starter\"] = self[\"webpackChunkreact_ts_tailwind_starter\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [967,810,76], () => (__webpack_require__(6462)))\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["deferred","GraphNodeType","Graph","constructor","ioHeight","this","xScale","d3","yScale","inputs","inputIdx","node","key","type","Input","fy","fx","push","outputs","outputIdx","Output","nextId","nodeA","Internal","nodeB","nodes","edges","source","target","routePermutation","perm","paths","visitedVerts","Set","routePermutation_recurse","pathIdx","dst","lut","newPath","stack","atEntry","pop","length","has","add","neighbors","adjacentVerts","neighbor","result","edge","getNextId","Construction","_ref","ref","useRef","dummyRectRef","size","setSize","useState","draggedNode","setDraggedNode","edgeInteraction","setEdgeInteraction","graph","setGraph","simulation","setSimulation","forceUpdate","useReducer","x","screenWidth","width","screenHeight","height","ticked","getEventPoint","e","svgPoint","DOMPoint","clientX","clientY","matrixTransform","current","getScreenCTM","inverse","y","reheat","alpha","restart","handleMouseDown","ex","ey","ctrlKey","newNode","stopPropagation","altKey","fromNode","toX","toY","handleMouseUp","undefined","newEdge","useLayoutEffect","getBoundingClientRect","sim","on","force","window","useResizeObserver","entry","contentRect","graphCanvas","canvas","src","tgt","line","_jsx","x1","y1","x2","y2","stroke","strokeWidth","index","color","circ","cx","cy","r","fill","onMouseDown","onMouseUp","drawGraph","svg","_jsxs","className","viewBox","onMouseMove","children","opacity","style","background","flexDirection","Permutation","invLut","Array","i","invert","swap","allPerms_recurse","unusedNums","n","perms","unusedList","from","toSorted","unusedNum","delete","allPerms","Main","setIoHeight","setPerms","permCards","toString","Splitter","SplitterPanel","InputNumber","name","value","onValueChange","val","isNaN","mode","showButtons","min","max","root","ReactDOM","document","getElementById","initMacros","render","React","PrimeReactProvider","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","m","O","chunkIds","fn","priority","notFulfilled","Infinity","fulfilled","j","Object","keys","every","splice","d","definition","o","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","data","moreModules","runtime","some","id","chunkLoadingGlobal","self","forEach","bind","__webpack_exports__"],"sourceRoot":""}