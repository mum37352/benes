(()=>{"use strict";var e,t={4313:(e,t,r)=>{var n=r(6540),s=r(5338),o=r(1925),i=r(1821),l=r(2349),u=(r(2222),r(9980)),a=r(4682),h=r(6801),f=r(4903);function d(e){return h.exT().domain([0,e]).interpolator((t=["#fa7970","#ecf2f8","#faa356","#7ce38b","#a2d2fb","#77bdfb","#cea5fb"],e=>h.$Bd(h.dJd,t)(Math.min(Math.max(0,e),1))));var t}var c=r(6313);let p=function(e){return e[e.Input=0]="Input",e[e.Output=1]="Output",e[e.Internal=2]="Internal",e}({});class g{constructor(e){this.xScale=h.m4Y([-6,6],[0,928]),this.yScale=h.m4Y([-1,e],[0,680]),this.ioHeight=e,this.inputs=[];for(let t=0;t<e;t++){let[e,r]=this.getInputPos(t),n={key:"in_"+t,type:p.Input,fx:e,fy:r};this.inputs.push(n)}this.outputs=[];for(let t=0;t<e;t++){let[e,r]=this.getOutputPos(t),n={key:"out_"+t,type:p.Output,fx:e,fy:r};this.outputs.push(n)}this.nextId=0,this.nodes=[...this.inputs,...this.outputs],this.edges=[],this.routingLut=new Map}static makeCompleteBipartiteGraph(e){let t=new g(e);for(let r=0;r<e;r++)for(let n=0;n<e;n++){let e={source:t.inputs[r],target:t.outputs[n]};t.edges.push(e)}return t.routeAllPermutations(),t}getInputPos(e){return[this.xScale(-5),this.yScale(e)]}getOutputPos(e){return[this.xScale(5),this.yScale(e)]}foreachEdgeSubset(e){let t=new Array(this.edges.length).fill(!1);for(;;){if(e(t))return!0;let r=!1;for(let e=0;e<t.length&&!r;e++)t[e]||(r=!0),t[e]=!t[e];if(!r)return!1}}hasNoValence3Nodes(e){let t=new Map;function r(e){let r=t.get(e);return r?r++:r=1,t.set(e,r),r}for(let t=0;t<e.length;t++)if(e[t]){let e=this.edges[t],n=r(e.source),s=r(e.target);if(n>2||s>2)return null}return t}routeAllPermutations(){let e=new Map;return this.foreachEdgeSubset((t=>{let r=!0;for(let e=0;e<t.length;e++)t[e]!==(e%this.ioHeight===Math.floor(e/this.ioHeight))&&(r=!1);let n=this.hasNoValence3Nodes(t);if(!n)return!1;for(let e=0;e<this.ioHeight;e++)if(1!==n.get(this.inputs[e]))return!1;for(let e=0;e<this.ioHeight;e++)if(1!==n.get(this.outputs[e]))return!1;let s=[],o=[];for(let e=0;e<this.ioHeight;e++){let r=[this.inputs[e]];for(;;){let e=r.at(-1),n=r.at(-2),s=this.incidentEdgeIndices(e),o=!1;for(let i of s)if(t[i]){let t=this.edges[i],s=this.getOppositeEdgeNode(t,e);if(s!==n){r.push(s),o=!0;break}}if(!o)break}let n=!1;for(let e=0;e<this.ioHeight;e++){let t=this.outputs[e];if(r.at(-1)===t){s.push(e),n=!0;break}}if(!n)return!1;o.push(r)}return e.set(s.toString(),o),!1})),this.routingLut=e,e}getOppositeEdgeNode(e,t){return e.source===t?e.target:e.source}adjacentVerts(e){let t=[];for(let r of this.edges)r.source===e?t.push(r.source):r.target===e&&t.push(r.target);return t}incidentEdgeIndices(e){let t=[];for(let r=0;r<this.edges.length;r++){let n=this.edges[r];(n.source===e||n.target===e)&&t.push(r)}return t}getNextId(){return this.nextId++}}var x=r(4848);function y(e){let{ioHeight:t,perm:r}=e,s=(0,n.useRef)(null),o=(0,n.useRef)(null),[i,l]=(0,n.useState)(),[u,y]=(0,n.useState)(),[m,v]=(0,n.useState)(),[w,j]=(0,n.useState)(new g(t));if(0===w.edges.length){j(g.makeCompleteBipartiteGraph(t))}let[N,k]=(0,n.useState)(new f.Ay([...Array(t).keys()]));null==r&&(r=N);let[S,b]=(0,n.useState)(),[,O]=(0,n.useReducer)((e=>e+1),0),P=i?.width||0,I=i?.height||0;function M(){O()}function C(e,t){let r=new DOMPoint(e,t);return r=r.matrixTransform(o.current?.getScreenCTM()?.inverse()),[r.x,r.y]}function A(e){return C(e.clientX,e.clientY)}function E(){S?.nodes(w.nodes).alpha(1).restart(),O()}function H(e,t){let[r,n]=A(e);if(e.ctrlKey){let t={type:p.Internal,key:"usrnd_"+w.getNextId(),y:n,x:r};w.nodes.push(t),w.routeAllPermutations(),E(),e.stopPropagation()}else e.altKey?t&&(v({fromNode:t,toX:r,toY:n}),e.stopPropagation()):t?.type===p.Internal&&(y(t),e.stopPropagation())}function _(e,t){let[r,n]=A(e);if(u&&(u.fx=u.fy=void 0,u.x=r,u.y=n,E(),y(void 0),e.stopPropagation()),m){if(t){let e={source:m.fromNode,target:t};w.edges.push(e),w.routeAllPermutations()}E(),v(void 0),e.stopPropagation()}}(0,n.useLayoutEffect)((()=>{l(s.current?.getBoundingClientRect());let e=h.tXi(w.nodes);e.on("tick",M),e.force("charge",h.xJS()),e.force("springs",h.kJC(w.edges)),b(e)}),[s]),"undefined"!=typeof window&&(0,a.A)(s,(e=>l(e.contentRect)));let R=[];!function(e){for(let t of w.edges){let r=t.source,n=t.target,s=(0,x.jsx)("line",{x1:r.x,y1:r.y,x2:n.x,y2:n.y,stroke:"white",strokeWidth:2},t.index);e.push(s)}var n=d(t);let s=w.routingLut.get(r.lut.toString());if(s)for(let[t,r]of s.entries())for(let s=0;s<r.length-1;s++){let o=r[s],i=r[s+1],l=(0,x.jsx)("line",{x1:o.x,y1:o.y,x2:i.x,y2:i.y,stroke:n(t),strokeWidth:5});e.push(l)}if(m){let t=m.fromNode,r=(0,x.jsx)("line",{x1:t.x,y1:t.y,x2:m.toX,y2:m.toY,stroke:"white",strokeWidth:4},"edgeInteract");e.push(r)}for(let t of w.nodes){let r;t.type===p.Internal?r="#ecf2f8":t.type===p.Input?r="#faa356":t.type===p.Output&&(r="#a2d2fb");let n=(0,x.jsx)("circle",{cx:t.x,cy:t.y,r:10,fill:r,onMouseDown:e=>H(e,t),onMouseUp:e=>_(e,t)},t.key);e.push(n)}}(R);let B=(0,x.jsxs)("svg",{className:"absolute",width:P,height:I,viewBox:"0 0 928 680",children:[(0,x.jsx)("rect",{ref:o,opacity:0,x:"0",y:"0",width:"0",height:"0",stroke:"none",fill:"none"}),R]});return(0,x.jsx)("div",{className:"flex items-stretch w-full h-full p-1",style:{background:"#161b22",flexDirection:"row"},children:(0,x.jsx)("div",{className:"flex grow items-stretch p-1",onMouseDown:H,onMouseMove:function(e){let[t,r]=A(e);u?(u.fx=t,u.fy=r,E()):m&&(v({fromNode:m.fromNode,toX:t,toY:r}),e.stopPropagation())},onMouseUp:_,children:(0,x.jsxs)("div",{ref:s,className:"relative flex grow p-0 m-0 overflow-hidden",children:[B,(0,x.jsx)(c.A,{perm:r,onPermChanged:function(e){k(e)},vertical:!1,idxToXY:e=>function(e,t){let r=new DOMPoint(e,t),n=o.current?.getScreenCTM();if(!n)return[0,0];r=r.matrixTransform(n);let i=s.current?.getBoundingClientRect();return i&&(r.x-=i.left,r.y-=i.top),[r.x,r.y]}(...w.getOutputPos(e)),xyToIdx:(e,t)=>function(e,t){let[r,n]=C(e,t),s=w.yScale.invert(n);return(0,f.yE)(s,680)}(e,t)})]})})})}function m(){let[e,t]=(0,n.useState)(4),[r,s]=(0,n.useState)((0,f.NR)(e)),l=[];for(let t of r)l.push((0,x.jsx)("div",{className:"w-full h-96",children:(0,x.jsx)(y,{ioHeight:e,perm:t})}));return(0,x.jsxs)(o.O,{className:"h-dvh w-full",children:[(0,x.jsx)(o.K,{size:60,className:"overflow-hidden",children:(0,x.jsx)("div",{className:"w-full h-full",children:(0,x.jsx)(y,{perm:null,ioHeight:e})})}),(0,x.jsx)(o.K,{size:40,className:"",children:(0,x.jsxs)("div",{className:"overflow-auto w-full",children:[(0,x.jsx)(i.Y,{className:"",name:"benesOrder",value:e,onValueChange:e=>{let r=e.value;r&&!isNaN(r)&&t(r)},mode:"decimal",showButtons:!0,min:1,max:5}),(0,x.jsx)("div",{children:"Click and drag to move nodes, Ctrl-Click to add nodes, Alt-Click to add edges."}),(0,x.jsx)("h1",{children:"Permutations"}),l]})})]})}const v=s.createRoot(document.getElementById("root"));(0,u._)(),v.render((0,x.jsx)(n.StrictMode,{children:(0,x.jsx)(l.mD,{children:(0,x.jsx)("div",{className:"fixed flex overflow-hidden h-dvh w-full",children:(0,x.jsx)(m,{})})})}))},4903:(e,t,r)=>{r.d(t,{Ay:()=>n,NR:()=>i,yE:()=>s});class n{constructor(e){this.lut=[...e],this.invLut=Array(e.length);for(let t=0;t<e.length;t++)this.invLut[e[t]]=t}invert(){let e=this.invLut;this.invLut=this.lut,this.lut=e}}function s(e,t){return Math.min(t-1,Math.max(0,Math.round(e)))}function o(e,t,r,s){if(t.length===r)return void s.push(new n(t));let i=Array.from(e).toSorted();for(let n of i)t.push(n),e.delete(n),o(e,t,r,s),e.add(n),t.pop()}function i(e){let t=new Set;for(let r=0;r<e;r++)t.add(r);let r=[];return o(t,[],e,r),r}}},r={};function n(e){var s=r[e];if(void 0!==s)return s.exports;var o=r[e]={exports:{}};return t[e](o,o.exports,n),o.exports}n.m=t,e=[],n.O=(t,r,s,o)=>{if(!r){var i=1/0;for(h=0;h<e.length;h++){for(var[r,s,o]=e[h],l=!0,u=0;u<r.length;u++)(!1&o||i>=o)&&Object.keys(n.O).every((e=>n.O[e](r[u])))?r.splice(u--,1):(l=!1,o<i&&(i=o));if(l){e.splice(h--,1);var a=s();void 0!==a&&(t=a)}}return t}o=o||0;for(var h=e.length;h>0&&e[h-1][2]>o;h--)e[h]=e[h-1];e[h]=[r,s,o]},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.j=276,(()=>{var e={276:0};n.O.j=t=>0===e[t];var t=(t,r)=>{var s,o,[i,l,u]=r,a=0;if(i.some((t=>0!==e[t]))){for(s in l)n.o(l,s)&&(n.m[s]=l[s]);if(u)var h=u(n)}for(t&&t(r);a<i.length;a++)o=i[a],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(h)},r=self.webpackChunkreact_ts_tailwind_starter=self.webpackChunkreact_ts_tailwind_starter||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var s=n.O(void 0,[967,810,76],(()=>n(4313)));s=n.O(s)})();
//# sourceMappingURL=construction.4852defdbbdc188df380.js.map